*mangle
:PREROUTING ACCEPT [100:7096]
:INPUT ACCEPT [96:6912]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [66:6532]
:POSTROUTING ACCEPT [66:6532]
:SHADOWSOCKS - [0:0]
-A PREROUTING -j SHADOWSOCKS
-A SHADOWSOCKS -p udp -j TPROXY --dport 53 --on-port 12345 --tproxy-mark 0x1/0x1
COMMIT

*nat
:PREROUTING ACCEPT [60875:5090701]
:INPUT ACCEPT [25589:2152335]
:OUTPUT ACCEPT [30783:3343258]
:POSTROUTING ACCEPT [13367:807849]
:SHADOWSOCKS - [0:0]
-A PREROUTING -p tcp -j SHADOWSOCKS
-A POSTROUTING -o eth0 -j MASQUERADE
-A SHADOWSOCKS -d 137.116.154.155/32 -j RETURN
-A SHADOWSOCKS -d 0.0.0.0/8 -j RETURN
-A SHADOWSOCKS -d 10.0.0.0/8 -j RETURN
-A SHADOWSOCKS -d 127.0.0.0/8 -j RETURN
-A SHADOWSOCKS -d 169.254.0.0/16 -j RETURN
-A SHADOWSOCKS -d 172.16.0.0/12 -j RETURN
-A SHADOWSOCKS -d 192.168.0.0/16 -j RETURN
-A SHADOWSOCKS -d 224.0.0.0/4 -j RETURN
-A SHADOWSOCKS -d 240.0.0.0/4 -j RETURN

# subnet: <%= country %>
<%= lines %>
-A SHADOWSOCKS -p tcp -j REDIRECT --to-ports 12345
COMMIT
